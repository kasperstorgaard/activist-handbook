<link rel="import" href="../../../libs/redux/redux-actions.html">
<link rel="import" href="../root-store.html">

<script>
  (() => {
    const Stores = window.Stores || (window.Stores = {});

    // Types
    const INIT = 'countries/INIT';
    const LOAD = 'countries/LOAD';

    // Actions
    const init = ReduxActions.createAction(INIT);
    const load = ReduxActions.createAction(LOAD);

    // Operations
    const hydrate = (countriesPromise) =>
      async dispatch => {
        await dispatch(init());
        const countries = await countriesPromise;
        dispatch(load(countries));
      };

    // State
    const initialState = {
      loading: false,
      items: []
    };

    // Reducers
    const reducer = ReduxActions.handleActions({
      [INIT]: (state, {payload}) => Object.assign(state, {loading: true}),
      [LOAD]: (state, {payload}) => Object.assign(state, {items: payload, loading: false})
    }, initialState);

    Stores.addReducers({countries: reducer});

    Stores.Countries = {
      types: {
        INIT,
        LOAD
      },
      init,
      load,
      hydrate
    };
  })();
</script>